Есть несколько способов работы с обнаружением сервисов. Трис самых популярных.
![[обнаружение сервисов.png]]

1. В первом случае мы не обременяем клиента и разрешаем обращаться к любому узлу. Если запрос адресован не ему, то узел выступит в роли прокси.
2. Отправлять все запросы через маршрутизатор.
3. Клиент сам четко знает где находится нужный узел.

## Варианты определения по ключу инстансов
Поиск инстансов по ключу для распределенных систем кэшировния, шардирования и других можно использовать такие варианты.

### по диапозонам
Разбиваем инстансы по диапозонам, например, если у нас айдишник целое число (диапозоны типа 0-1000, 1001-2000).  Или хешировать значений ключа и делить хэш на диапазоны.
плюсы:
 - количество шардов растет постепенно.
 - возможность регулировать нагрузку.
 - гибкие возможности для регулирования логики определения шарда.
минусы:
 - логику приходится настраивать самостоятельно, также самостоятельно подключать и деплоить шарды.
 
 ### остаток от деления
 Ключ делится по модулю и берется нужный номер шарда.
 плюсы:
  - логика вычисления шарда проста как валенок - одна операция деления
  - равномерное распределение нагрузки на шарды
 минусы:
  - надо сразу резервировать шарды, иначе перераспределять данные будет больно
 
 ### consistent hashing
1. "Чертим круг" с диапозоном хэша.
2. На кругу отмечаем значения, к которым привязываем инстансы.
3. Инстанс отвечает за все ключи, которые содержат диапозон от него, до след инстанса.

Добавление нового инстанса не приводит к особым проблемам, нужно лишь перегнать ключи со старого